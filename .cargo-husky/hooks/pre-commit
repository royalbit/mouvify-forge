#!/bin/bash
# Forge pre-commit hook - mirrors CI checks
# Auto-installed by cargo-husky on `cargo test`

set -e

echo "ğŸ” Running pre-commit checks..."

echo "ğŸ“ Checking formatting..."
cargo fmt --all -- --check

echo "ğŸ“ Running clippy..."
cargo clippy -- -D warnings

# RoyalBit Asimov checks (if installed)
if command -v asimov &> /dev/null; then
    # Protocol refresh - injects rules into fresh context (survives compaction)
    asimov refresh

    echo "ğŸ“‹ Validating protocol files..."
    asimov validate || true  # Don't fail on missing files

    echo "ğŸ“ Linting documentation..."
    asimov lint-docs docs/ || exit 1
fi

echo "âœ… Pre-commit checks passed!"
