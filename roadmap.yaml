# üî• Forge Roadmap to 1.0.0
# Track the evolution from current state to production-ready 1.0.0
# This file itself is a YAML model - we should be able to use forge on it later!

metadata:
  current_version: "0.2.0"
  target_version: "1.0.0"
  last_updated: "2025-11-23"
  maintainer: "RoyalBit Inc."
  notes: "Skipping v0.3.0 and v0.4.0 - jumping directly to v1.0.0 to avoid migration debt"

# Version milestones
milestones:
  v0_1_3:
    version: "0.1.3"
    status: completed
    release_date: "2025-11-23"
    description: "Current stable release"
    features:
      - "Basic formula evaluation with meval"
      - "Cross-file references with includes"
      - "Dependency resolution and topological sort"
      - "Validation command"
      - "Circular dependency detection"
    capabilities:
      - "Simple math operations (+, -, *, /, ^)"
      - "Variable references (dot notation)"
      - "Cross-file references (@alias.variable)"
      - "Dry-run mode"
      - "Verbose output"

  v0_2_0:
    version: "0.2.0"
    status: completed
    release_date: "2025-11-23"
    description: "Excel-compatible formula functions"
    branch: "feature/formula-functions"
    breaking_changes: false
    features:
      - "Replace meval with xlformula_engine"
      - "Excel-compatible formula functions"
      - "Better error messages with formula context"
      - "Optional version metadata in YAML files"
    new_functions:
      aggregation:
        - "SUM(a, b, c, ...)"
        - "AVERAGE(a, b, c, ...)"
        - "COUNT(a, b, c, ...)"
        - "MAX(a, b, c, ...)"
        - "MIN(a, b, c, ...)"
        - "PRODUCT(a, b, c, ...)"
      logical:
        - "IF(condition, true_value, false_value)"
        - "AND(a, b, c, ...)"
        - "OR(a, b, c, ...)"
        - "NOT(a)"
        - "XOR(a, b)"
      utility:
        - "ABS(a)"
        - "ISBLANK(a)"
    model_compatibility:
      old_model: "‚úÖ Full backwards compatibility"
      new_model: "‚ùå Not yet (comes in v1.0.0)"
    testing:
      - "Unit tests for each new function"
      - "E2E tests with financial model examples"
      - "Validation tests for function results"
    documentation:
      - "Update README with function examples"
      - "Add formula function reference"
      - "Migration guide (none needed - backwards compatible)"

  v0_3_0:
    version: "0.3.0"
    status: skipped
    reason: "Merged into v1.0.0 to avoid migration complexity"
    features_moved_to: "v1.0.0 or post-1.0.0"

  v0_4_0:
    version: "0.4.0"
    status: skipped
    reason: "Merged into v1.0.0 to avoid migration complexity"
    features_moved_to: "v1.0.0"

  v1_0_0:
    version: "1.0.0"
    status: in_progress
    branch: "feature/v1.0.0-array-model"
    started_date: "2025-11-23"
    target_date: "2025-12-15"
    description: "Excel-compatible array model with zero-error financial calculations"
    breaking_changes: true
    breaking_change_details:
      - "New array model (column arrays map 1:1 with Excel columns)"
      - "Backwards compatible with v0.2.0 scalar model"
      - "JSON Schema validation for type safety"

    implementation_phases:
      phase_1_parser:
        name: "Array Parser"
        status: completed
        completed_date: "2025-11-23"
        commits:
          - "f2902c0: Implement Phase 1: Array Parser"
        features:
          - "‚úÖ Type-safe array parsing (Number, Text, Date, Boolean)"
          - "‚úÖ Homogeneous type validation"
          - "‚úÖ Automatic version detection (v0.2.0 vs v1.0.0)"
          - "‚úÖ JSON Schema validation"
          - "‚úÖ Table validation (consistent column lengths)"
          - "‚úÖ Full backwards compatibility with v0.2.0"
        test_coverage: "29/29 unit tests + 3/3 v1.0 integration tests passing"

      phase_2_calculator:
        name: "Array-aware Calculator"
        status: in_progress
        progress: "50%"
        commits:
          - "63a5c99: Implement Phase 2 Part 1: Row-wise formulas"
        features_completed:
          - "‚úÖ Row-wise formula evaluation (element-wise operations)"
          - "‚úÖ Intra-table dependency resolution"
          - "‚úÖ Formulas like profit[i] = revenue[i] - expenses[i]"
        features_in_progress:
          - "‚è∏Ô∏è Aggregation formulas (SUM, AVERAGE, MAX, MIN)"
          - "‚è∏Ô∏è Cross-table references (table1.column2)"
          - "‚è∏Ô∏è Array indexing (revenue[0])"
        features_pending:
          - "‚è∏Ô∏è Conditional aggregation (SUMIF, COUNTIF)"
          - "‚è∏Ô∏è Cross-file array references (@alias.table.column)"
        test_coverage: "32/32 unit tests + 1 array calculator test passing"

      phase_3_excel_export:
        name: "Excel Export"
        status: pending
        features:
          - "YAML tables ‚Üí Excel sheets"
          - "Column arrays ‚Üí Excel columns"
          - "Row-wise formulas ‚Üí Excel formulas"
          - "Preserve number formatting"

      phase_4_migration_tool:
        name: "Migration Tool"
        status: pending
        features:
          - "Auto-detect v0.2.0 scalar models"
          - "Convert to v1.0.0 array model where applicable"
          - "forge upgrade command"

      phase_5_polish:
        name: "Testing & Polish"
        status: pending
        features:
          - "100+ comprehensive tests"
          - "Round-trip tests (YAML ‚Üí Excel ‚Üí YAML)"
          - "Performance benchmarks"
          - "Complete documentation"

    new_types:
      - "ForgeVersion enum (V0_2_0, V1_0_0)"
      - "ColumnValue enum (Number, Text, Date, Boolean)"
      - "Column, Table, ParsedModel structs"

    new_modules:
      - "src/parser/mod.rs - parse_model() for unified parsing"
      - "src/core/array_calculator.rs - ArrayCalculator for v1.0.0"

    model_support:
      v0_2_0_scalars: "‚úÖ Full backwards compatibility"
      v1_0_0_arrays: "üü° In progress (row-wise ‚úÖ, aggregations ‚è∏Ô∏è)"

    testing_status:
      unit_tests: "32 passing"
      integration_tests: "3 v1.0 parser tests + 1 calculator test"
      e2e_tests: "24/25 passing (1 pre-existing fuzzy matching issue)"

    documentation:
      - "‚úÖ DESIGN_V1.md - 800+ line comprehensive spec"
      - "‚úÖ schema/forge-v1.0.schema.json - Complete JSON Schema"
      - "‚úÖ Example files (saas_unit_economics, quarterly_pl, budget_vs_actual)"
      - "‚è∏Ô∏è Migration guide (pending)"
      - "‚è∏Ô∏è API documentation (pending)"

# Feature tracking
features:
  formula_functions:
    version_introduced: "0.2.0"
    status: completed
    priority: high
    effort: medium
    description: "Excel-compatible formula functions (SUM, AVERAGE, PRODUCT, IF, ABS)"
    dependencies: []
    note: "v0.2.0 intentionally limited to basic functions to avoid migration complexity with v1.0.0 array model"

  audit_trail:
    version_introduced: "0.3.0"
    status: planned
    priority: medium
    effort: low
    description: "Show how a value was calculated with dependency chain"
    dependencies: []

  watch_mode:
    version_introduced: "0.3.0"
    status: planned
    priority: medium
    effort: medium
    description: "Auto-recalculate when files change"
    dependencies: []

  array_model:
    version_introduced: "1.0.0"
    status: in_progress
    progress: "50%"
    priority: high
    effort: high
    description: "Column array model for Excel-like tables"
    dependencies: ["formula_functions"]
    completed:
      - "Array parser with type validation"
      - "Row-wise formula evaluation"
      - "Intra-table dependency resolution"
    in_progress:
      - "Aggregation formulas"
      - "Cross-table references"
    pending:
      - "Array indexing"
      - "Conditional aggregations"

  model_conversion:
    version_introduced: "1.0.0"
    status: pending
    priority: high
    effort: medium
    description: "Auto-detect and convert between model versions"
    dependencies: ["array_model"]
    note: "Phase 4 of v1.0.0 implementation"

  excel_export:
    version_introduced: "1.0.0"
    status: planned
    priority: high
    effort: high
    description: "Export YAML to Excel .xlsx files"
    dependencies: ["array_model", "model_conversion"]

  excel_import:
    version_introduced: "1.0.0"
    status: planned
    priority: medium
    effort: high
    description: "Import Excel .xlsx to YAML"
    dependencies: ["excel_export"]

  conditional_aggregation:
    version_introduced: "1.0.0"
    status: planned
    priority: medium
    effort: medium
    description: "SUMIF, AVERAGEIF, COUNTIF functions"
    dependencies: ["formula_functions", "array_model"]

  financial_functions:
    version_introduced: "1.0.0"
    status: planned
    priority: low
    effort: high
    description: "NPV, IRR, PMT, FV, PV functions"
    dependencies: ["formula_functions"]

# Technical debt and improvements
technical_debt:
  replace_meval:
    status: in_progress
    priority: high
    version: "0.2.0"
    description: "Replace meval with xlformula_engine for Excel compatibility"

  proper_formula_parser:
    status: completed_via_xlformula_engine
    priority: high
    version: "0.2.0"
    description: "Replace regex-based formula parsing with proper parser"

  incremental_calculation:
    status: planned
    priority: medium
    version: "0.3.0"
    description: "Only recalculate variables affected by changes"

  better_error_messages:
    status: planned
    priority: high
    version: "0.3.0"
    description: "File:line context, dependency chains, typo suggestions"

# Community and ecosystem
ecosystem:
  vscode_extension:
    status: idea
    priority: low
    version: "post-1.0.0"
    description: "Syntax highlighting, inline values, error squiggles"

  github_action:
    status: idea
    priority: medium
    version: "post-1.0.0"
    description: "Validate formulas in CI/CD"

  web_ui:
    status: idea
    priority: low
    version: "post-1.0.0"
    description: "Visual formula builder for non-technical users"

  python_bindings:
    status: idea
    priority: low
    version: "post-1.0.0"
    description: "Use forge from Python via PyO3"

# Success metrics
metrics:
  performance:
    current: "<200ms for 850 formulas"
    v0_2_0_target: "<250ms for 850 formulas (slight overhead from xlformula_engine)"
    v1_0_0_target: "<300ms for 1000 formulas with Excel export"

  test_coverage:
    current: "40 tests (unit + integration + E2E)"
    v0_2_0_target: "60+ tests (add function tests)"
    v1_0_0_target: "100+ tests (comprehensive coverage)"

  downloads:
    current: "TBD (track from crates.io)"
    v1_0_0_target: "1000+ downloads"

  github_stars:
    current: "TBD"
    v1_0_0_target: "100+ stars"

  adoption:
    target: "10+ companies using in production by v1.0.0"

# Risk management
risks:
  xlformula_engine_maintenance:
    probability: medium
    impact: high
    mitigation: "Fork if needed, or contribute back to maintain it"

  excel_format_complexity:
    probability: high
    impact: medium
    mitigation: "Use rust_xlsxwriter (battle-tested library)"

  backwards_compatibility:
    probability: low
    impact: high
    mitigation: "Maintain v1 model support through v1.x, deprecate in v2.0.0"

  performance_regression:
    probability: medium
    impact: medium
    mitigation: "Benchmark suite in v0.3.0, track performance over time"
