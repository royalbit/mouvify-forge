# Reusable workflow for Forge validation
# Usage in other repos:
#   jobs:
#     validate:
#       uses: royalbit/forge/.github/workflows/forge-validate.yml@main
#       with:
#         files: 'models/**/*.yaml'

name: Forge Validate (Reusable)

on:
  workflow_call:
    inputs:
      files:
        description: 'Glob pattern for YAML files to validate'
        required: false
        type: string
        default: '**/*.forge.yaml'
      fail-on-error:
        description: 'Fail if validation errors found'
        required: false
        type: boolean
        default: true
      working-directory:
        description: 'Working directory'
        required: false
        type: string
        default: '.'
    outputs:
      validated:
        description: 'Number of files validated'
        value: ${{ jobs.validate.outputs.validated }}
      errors:
        description: 'Number of errors found'
        value: ${{ jobs.validate.outputs.errors }}
      status:
        description: 'Validation status'
        value: ${{ jobs.validate.outputs.status }}

jobs:
  validate:
    name: Validate Forge Models
    runs-on: ubuntu-latest
    outputs:
      validated: ${{ steps.validate.outputs.validated }}
      errors: ${{ steps.validate.outputs.errors }}
      status: ${{ steps.validate.outputs.status }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate Forge YAML files
        id: validate
        uses: royalbit/forge/.github/actions/validate@main
        with:
          files: ${{ inputs.files }}
          fail-on-error: ${{ inputs.fail-on-error }}
          working-directory: ${{ inputs.working-directory }}
