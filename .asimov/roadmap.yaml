# Forge Roadmap
# For version history, see CHANGELOG.md
# Last updated: 2025-12-06
#
# ═══════════════════════════════════════════════════════════════════════════════
# CODING STANDARDS
# ═══════════════════════════════════════════════════════════════════════════════
# - Unit tests: Keep with code (Rust way: #[cfg(test)] mod tests in same file)
# - Test coverage: 100% mandatory for all functional code
# - No file > 1,000 lines (split into submodules when exceeded)
# - Zero warnings policy
# ═══════════════════════════════════════════════════════════════════════════════

metadata:
  current_version: "5.2.0"
  last_updated: "2025-12-06"
  philosophy: "Zero tokens. Zero emissions. $40K-$132K/year saved."

# Current Release
current:
  version: "5.2.0"
  status: released
  date: "2025-12-06"
  summary: "AST Parser - Clean Architecture"
  highlights:
    - "AST parser replaces regex (5,750 → 5,582 lines, modular)"
    - "Tokenizer → Parser → Evaluator pipeline"
    - "Chrono for date functions"
    - "Both array and scalar formulas use AST"
  stats:
    tests: 918
    warnings: 0
    functions_total: 81
    coverage: "~91%"
    commands_coverage: "95.1%"

# ═══════════════════════════════════════════════════════════════════════════════
# NEXT MILESTONE
# ═══════════════════════════════════════════════════════════════════════════════

next:
  - version: "5.3.0"
    summary: "Code Organization - Split Large Files"
    priority: HIGH
    status: pending

    rationale: |
      Large files hurt human readability and maintainability.
      evaluator.rs (2,918 lines) has 16 clear sections that can be split.
      parser/mod.rs (2,059 lines) is clean serde_yaml, split by feature.
      Tests stay with code per Rust convention (#[cfg(test)] mod tests).

    deliverables:
      - task: "Split evaluator.rs into submodules by function category"
        status: pending
        details: |
          evaluator/
          ├── mod.rs          (~300 lines) - Value, EvalContext, evaluate(), dispatch + tests
          ├── math.rs         (~170 lines) - ABS, ROUND, SQRT, POW, EXP, LN, LOG + tests
          ├── aggregation.rs  (~90 lines)  - SUM, AVERAGE, COUNT, MIN, MAX, PRODUCT + tests
          ├── statistical.rs  (~135 lines) - STDEV, VAR, MEDIAN, PERCENTILE, CORREL + tests
          ├── conditional.rs  (~205 lines) - SUMIF, COUNTIF, AVERAGEIF, SUMIFS + tests
          ├── array.rs        (~55 lines)  - INDEX, MATCH, CHOOSE + tests
          ├── logical.rs      (~50 lines)  - IF, AND, OR, NOT, IFS + tests
          ├── text.rs         (~75 lines)  - CONCAT, LEFT, RIGHT, MID, LEN + tests
          ├── dates.rs        (~300 lines) - TODAY, DATE, YEAR, EDATE, EOMONTH + tests
          ├── lookup.rs       (~250 lines) - VLOOKUP, HLOOKUP, XLOOKUP, INDIRECT + tests
          ├── financial.rs    (~330 lines) - NPV, IRR, PMT, PV, FV, SLN, DB, DDB + tests
          ├── forge.rs        (~150 lines) - VARIANCE_STATUS, SCENARIO, GROWTH_RATE + tests
          └── advanced.rs     (~115 lines) - LET, LAMBDA, SWITCH, FILTER, SORT + tests

      - task: "Split parser/mod.rs into submodules (2,059 lines)"
        status: pending
        details: |
          parser/
          ├── mod.rs        (~200 lines) - entry point, dispatch + tests
          ├── single.rs     (~150 lines) - single doc parsing + tests
          ├── multi_doc.rs  (~100 lines) - multi-document YAML + tests
          ├── includes.rs   (~80 lines)  - file includes resolution + tests
          ├── tables.rs     (~150 lines) - table/column parsing + tests
          ├── scalars.rs    (~100 lines) - scalar variable parsing + tests
          ├── scenarios.rs  (~50 lines)  - scenario parsing + tests
          └── validation.rs (~30 lines)  - JSON schema validation + tests

      - task: "Split commands.rs by command handler (2,445 lines)"
        status: pending
        details: |
          commands/
          ├── mod.rs         - dispatch + shared helpers + tests
          ├── calculate.rs   - calculate() + tests
          ├── validate.rs    - validate() + tests
          ├── audit.rs       - audit(), dependency tree + tests
          ├── export.rs      - export() + tests
          ├── import.rs      - import() + tests
          ├── compare.rs     - compare() + tests
          ├── variance.rs    - variance() + tests
          ├── sensitivity.rs - sensitivity() + tests
          ├── goal_seek.rs   - goal_seek() + tests
          ├── break_even.rs  - break_even() + tests
          ├── functions.rs   - functions() + tests
          ├── upgrade.rs     - upgrade() + tests
          └── watch.rs       - watch() + tests

    success_criteria:
      - "No file > 1,000 lines"
      - "Unit tests in same file as code (Rust convention)"
      - "All 918+ tests pass"
      - "Zero warnings"

# ═══════════════════════════════════════════════════════════════════════════════
# RELEASED VERSIONS (summary only - see CHANGELOG.md for details)
# ═══════════════════════════════════════════════════════════════════════════════

released:
  - version: "5.2.0"
    date: "2025-12-06"
    summary: "AST Parser - Clean Architecture"
  - version: "5.0.0"
    date: "2025-12-04"
    summary: "BREAKING: MIT → Proprietary"
  - version: "4.4.2"
    date: "2025-12-04"
    summary: "Multi-Document YAML + Includes Export"
  - version: "4.4.1"
    date: "2025-12-04"
    summary: "Scalar Math Functions Bug Fix"
  - version: "4.4.0"
    date: "2025-12-04"
    summary: "Dynamic Array Functions + Scenario Modeling"
  - version: "4.3.0"
    date: "2025-12-04"
    summary: "File Write-Back + Strict Schema Validation"
  - version: "4.2.1"
    date: "2025-12-02"
    summary: "Bug Fixes - Real-world validation issues"
  - version: "4.2.0"
    date: "2025-12-01"
    summary: "Release Automation - Cross-platform CI/CD"

# ═══════════════════════════════════════════════════════════════════════════════
# MARKET INTELLIGENCE (Updated Dec 2025)
# ═══════════════════════════════════════════════════════════════════════════════

market:
  last_updated: "2025-12-04"

  microsoft_excel:
    copilot_function:
      launched: "Nov 2025"
      description: "=COPILOT() function in cells - AI generates content"
      limits: "100 calls/10min, 300 calls/hour"
      requires: "OneDrive/SharePoint (cloud-only)"
      weakness: "Still hallucinates - probabilistic, not deterministic"

  forge_differentiators:
    vs_copilot:
      - "Deterministic (same input = same output, always)"
      - "Local execution (no cloud dependency)"
      - "Git-friendly (YAML = version control)"
      - "No hallucinations (formulas, not predictions)"
      - "Forge-native FP&A functions (variance, break-even, scenarios)"

# ═══════════════════════════════════════════════════════════════════════════════
# BACKLOG & RESEARCH
# ═══════════════════════════════════════════════════════════════════════════════

backlog:
  - id: "test-coverage-100"
    title: "100% Test Coverage (ADR-004)"
    status: "in_progress (95.1%)"
    details: |
      Current: ~91% overall, commands.rs at 95.1%
      Remaining (~5%):
      - Edge case branches in audit(), variance(), compare() helpers
      - Some error paths in sensitivity/break_even output formatting
      - watch() excluded via ADR-006 (infinite loop)
  - "OpenAPI spec + Swagger UI for API server"
  - "Forge vs Copilot benchmark suite (marketing)"
  - "Excel compatibility matrix doc"

research:
  - id: "experiential-continuity"
    title: "Experiential Continuity Layer"
    status: research
    doc: "docs/research/EXPERIENTIAL_CONTINUITY.md"
